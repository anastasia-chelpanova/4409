#include <iostream>
#include <iomanip>

#include "IO.hpp"

/**
 * Выводит приветственный баннер программы в консоль.
 */
void PrintWelcome()
{
	std::cout << "******************************" << std::endl;
	std::cout << "* Computer Science Lab No. 4 *" << std::endl;
	std::cout << "******************************" << std::endl;
	std::cout << std::endl;
}

/**
 * Выводит стандартизированное сообщение об ошибке.
 */
void PrintError(
	const std::string& message)
{
	std::cout << "[ERROR] " << message << std::endl;
}

/**
 * Запрашивает у пользователя входные параметры и валидирует их.
 *
 * size   Ссылка на переменную для сохранения размера выборки (целое число).
 * minVal Ссылка на переменную для сохранения минимального значения (число с плавающей точкой).
 * maxVal Ссылка на переменную для сохранения максимального значения (число с плавающей точкой).
 *
 * Результат:
 *         - true: если все три значения были успешно введены и имеют корректный тип.
 *         - false: если произошла ошибка ввода (например, введено слово вместо числа).
 *
 * Принцип работы:
 * 1. Последовательно запрашивает три значения через std::cin.
 * 2. Проверяет состояние потока ввода после каждой операции (std::cin >> var).
 *    Если ввод не удался (например, пользователь ввел буквы вместо цифр), флаг ошибки потока устанавливается.
 * 3. В случае ошибки:
 *    - Выводит сообщение через PrintError.
 *    - Сбрасывает флаги ошибок потока (std::cin.clear()).
 *    - Очищает буфер ввода от некорректных данных до конца строки (std::cin.ignore(...)).
 *    - Немедленно возвращает false, прерывая дальнейший опрос.
 * 4. Использование ссылок (int&, float&) позволяет записать введенные данные напрямую
 *    в переменные вызывающей функции.
 */
bool GetInputVariables(
	int& size,
	float& minVal,
	float& maxVal)
{
	std::cout << "Enter sample size: ";
	// Проверка: удалось ли прочитать целое число
	if (!(std::cin >> size)) {
		PrintError("Integer expected!");
		// Восстановление состояния потока после ошибки
		std::cin.clear();
		// Пропуск невалидных символов в буфере до конца строки
		std::cin.ignore(std::numeric_limits<std::streamsize>::max(), '\n');
		return false;
	}

	std::cout << "Enter the minimum sample value: ";
	// Проверка: удалось ли прочитать число с плавающей точкой
	if (!(std::cin >> minVal)) {
		PrintError("Float expected!");
		std::cin.clear();
		std::cin.ignore(std::numeric_limits<std::streamsize>::max(), '\n');
		return false;
	}

	std::cout << "Enter the maximum sample value: ";
	// Проверка: удалось ли прочитать число с плавающей точкой
	if (!(std::cin >> maxVal)) {
		PrintError("Float expected!");
		std::cin.clear();
		std::cin.ignore(std::numeric_limits<std::streamsize>::max(), '\n');
		return false;
	}

	return true;
}

/**
 * Перегруженная функция для вывода результата вычислений (для типа float).
 */
void PrintResult(
	const std::string& message,
	float result)
{
	std::cout << message << ": " << result << std::endl;
}

/**
 * Перегруженная функция для вывода результата вычислений (для типа size_t).
 */
void PrintResult(
	const std::string& message,
	size_t result)
{
	std::cout << message << ": " << result << std::endl;
}

/**
 * Выводит содержимое вектора (выборки) в виде отформатированной таблицы.
 *
 * sample  Константная ссылка на вектор содержащий данные (float).
 * columns Количество столбцов в одной строке вывода.
 *
 * Принцип работы:
 * 1. Устанавливает фиксированный формат вывода чисел (std::fixed) и точность (5 знаков после запятой).
 * 2. Задает ширину поля для каждого числа (10 символов) через std::setw для выравнивания.
 * 3. Проходит циклом по всем элементам вектора.
 * 4. После вывода каждого элемента проверяет, заполнена ли строка:
 *    - Условие (i + 1) % columns == 0 означает, что выведено N элементов (кратно columns).
 *    - Если условие истинно, делается переход на новую строку (std::endl).
 * 5. После завершения цикла проверяется, остался ли незаполненный ряд:
 *    - Если размер выборки не кратен количеству столбцов, последняя строка не была завершена переводом строки внутри цикла.
 *    - Добавляется финальный std::endl для корректного завершения вывода.
 */
void PrintSample(
	const std::vector<float>& sample,
	int columns)
{
	std::cout << "Sample:" << std::endl;

	const int width = 10;		    // Ширина поля для одного числа
	const int precision = 5;		// Количество знаков после запятой
	
	// Настройка форматирования потока cout
	std::cout << std::fixed << std::setprecision(precision);

	for (size_t i = 0; i < sample.size(); ++i) {
		// Вывод числа с выравниванием по ширине
		std::cout << std::setw(width) << sample[i];

		// Проверка: нужно ли перейти на новую строку?
		// (i + 1) - потому что индекс i начинается с 0, а счетчик столбцов с 1
		if ((i + 1) % columns == 0) {
			std::cout << std::endl;
		}
	}

	// Если последний ряд был неполным, нужно принудительно перейти на новую строку
	if (sample.size() % columns != 0) {
		std::cout << std::endl;
	}
}